! function(c) {
    sitemartThemeModule.$document.on("djShopPageInit djArrowsLoadProducts djLoadMoreLoadProducts djProductsTabsLoaded djSearchFullScreenContentLoaded djBackHistory djRecentlyViewedProductLoaded", function() {
        sitemartThemeModule.updateWishlistButtonState()
    }), sitemartThemeModule.wishlist = function() {
        var d = "sitemart_wishlist_count",
            i = "sitemart_wishlist_products";
        if (sitemart_settings.is_multisite && (d += "_" + sitemart_settings.current_blog_id), "undefined" != typeof Cookies) {
            var t = Cookies.get(d),
                e = 0;
                elm_ = document.querySelectorAll('a[href="/wishlist/"] > span.dj-tools-icon > span')
            if (void 0 !== t) try {
                e = JSON.parse(t)
            } catch (t) {
                fg = 1;
            }
            void 0 !== sitemart_settings.wishlist_expanded && "yes" === sitemart_settings.wishlist_expanded || a(e), sitemartThemeModule.$body.on("click", ".dj-wishlist-btn a", function(t) {
                var e = c(this);
                if (e.hasClass("added")) return !0;
                t.preventDefault();
                var o, t = e.data("product-id"),
                    s = e.data("key");
                sitemartThemeModule.$body.hasClass("logged-in") || "undefined" == typeof Cookies ? (e.addClass("loading"), void 0 !== sitemart_settings.wishlist_expanded && "yes" === sitemart_settings.wishlist_expanded && "disable" !== sitemart_settings.wishlist_show_popup && sitemartThemeModule.$body.hasClass("logged-in") ? sitemartThemeModule.$document.trigger("djShowWishlistGroupPopup", [t, s]) : n(t, "", s)) : (s = {}, (o && (o = JSON.parse(o), Object.keys(o).length) ? o : s)[t] = {
                    product_id: t
                }, Cookies.set(d, o, {
                    expires: 7,
                    path: sitemart_settings.cookie_path,
                    secure: sitemart_settings.cookie_secure_param
                }), l(e, elm_))
            }), sitemartThemeModule.$body.on("click", ".dj-wishlist-remove", function(t) {
                t.preventDefault();
                var e, o = c(this),
                    t = "";
                o.parents(".dj-wishlist-group").length && (t = o.parents(".dj-wishlist-group").data("group-id")), o.addClass("loading"), sitemartThemeModule.$body.hasClass("logged-in") || "undefined" == typeof Cookies || 1 === o.parents(".dj-products").find(".dj-product").length ? r(o.data("product-id"), t, o.parents(".dj-products"), function() {
                    o.removeClass("loading")
                }) : (o.parents(".dj-product").remove(), t = {}, e && (t = JSON.parse(e), Object.keys(t).length) && delete t[o.data("product-id")], a(e = Object.keys(t).length), Cookies.set(d, e, {
                    expires: 7,
                    path: sitemart_settings.cookie_path,
                    secure: sitemart_settings.cookie_secure_param
                }))
            }), sitemartThemeModule.$body.on("click", ".dj-wishlist-checkbox", function(t) {
                var e = c(this),
                    o = e.parents(".dj-product"),
                    e = e.parents(".dj-products-element").siblings(".dj-wishlist-bulk-action"),
                    s = e.find(".dj-wishlist-select-all");
                o.toggleClass("dj-current-product"), s.hasClass("dj-selected") && e.hasClass("dj-visible") && !o.hasClass("dj-current-product") && s.removeClass("dj-selected"), o.siblings(".product").length === o.siblings(".dj-current-product").length && o.hasClass("dj-current-product") && s.addClass("dj-selected"), o.siblings(".dj-current-product").length || !e.hasClass("dj-visible") || o.hasClass("dj-current-product") ? e.addClass("dj-visible") : e.removeClass("dj-visible")
            }), sitemartThemeModule.$body.on("click", ".dj-wishlist-remove-action > a", function(t) {
                t.preventDefault();
                var e = c(this),
                    t = e.parents(".dj-wishlist-bulk-action").siblings(".dj-products-element").find(".products"),
                    o = t.find(".dj-current-product"),
                    s = [],
                    d = "";
                o.length && confirm(sitemart_settings.wishlist_remove_notice) && (e.addClass("loading"), e.parents(".dj-wishlist-group").length && (d = e.parents(".dj-wishlist-group").data("group-id")), o.each(function() {
                    s.push(c(this).data("id"))
                }), r(s, d, t, function() {
                    e.parents(".dj-wishlist-bulk-action").removeClass("dj-visible"), e.removeClass("loading")
                }))
            }), sitemartThemeModule.$body.on("click", ".dj-wishlist-select-all > a", function(t) {
                t.preventDefault();
                var t = c(this).parent(),
                    e = t.parents(".dj-wishlist-bulk-action").siblings(".dj-products-element").find(".products");
                t.hasClass("dj-selected") ? (e.find(".product").removeClass("dj-current-product").find(".dj-wishlist-checkbox").prop("checked", !1), t.removeClass("dj-selected"), t.parents(".dj-wishlist-bulk-action").removeClass("dj-visible")) : (e.find(".product").addClass("dj-current-product").find(".dj-wishlist-checkbox").prop("checked", !0), t.addClass("dj-selected"))
            }), sitemartThemeModule.$document.on("djAddProductToWishlist", function(t, e, o, s, d) {
                n(e, o, s, d)
            }), sitemartThemeModule.$document.on("djRemoveProductToWishlist", function(t, e, o, s, d) {
                r(e, o, s, d)
            }), sitemartThemeModule.$document.on("djUpdateWishlistContent", function(t, e) {
                var o;
                e = e, o = c(".dj-wishlist-content"), a(e.count), 0 < o.length && !o.hasClass("dj-wishlist-preview") && sitemartThemeModule.removeDuplicatedStylesFromHTML(e.wishlist_content, function(t) {
                    o.replaceWith(t), sitemartThemeModule.$document.trigger("djUpdateWishlist")
                })
            })
        }

        function a(t) {
            var e = c(".dj-header-wishlist");
            0 < e.length && e.find(".dj-tools-count").text(t)
        }

        function n(t, e, o, s = "") {
            var d = c("a[data-product-id=" + t + "]");
            c.ajax({
                url: sitemart_settings.ajaxurl,
                data: {
                    action: "sitemart_add_to_wishlist",
                    product_id: t,
                    group: e,
                    key: o
                },
                dataType: "json",
                method: "GET",
                success: function(t) {
                    t ? (t.count && a(t.count), t.fragments && (sitemartThemeModule.$document.trigger("djWishlistSaveFragments", [t.fragments, t.hash]), c.each(t.fragments, function(e, t) {
                        sitemartThemeModule.removeDuplicatedStylesFromHTML(t, function(t) {
                            c(e).replaceWith(t)
                        })
                    })), l(d)) : console.log("something wrong loading wishlist data ", t), s && s()
                },
                error: function() {
                    console.log("We cant add to wishlist. Something wrong with AJAX response. Probably some PHP conflict.")
                },
                complete: function() {
                    d.removeClass("loading")
                }
            })
        }

        function r(t, e, s, d = "") {
            var o = "";
            void 0 !== s.data("atts") && ((o = s.data("atts")).ajax_page = s.attr("data-paged")), c.ajax({
                url: sitemart_settings.ajaxurl,
                data: {
                    action: "sitemart_remove_from_wishlist",
                    product_id: t,
                    group_id: e,
                    key: sitemart_settings.wishlist_page_nonce,
                    atts: o
                },
                dataType: "json",
                method: "GET",
                success: function(t) {
                    var e, o;
                    t.wishlist_content ? (a(t.count), e = t, (o = s.parents(".dj-products-element")).length && !c(".dj-wishlist-content").hasClass("dj-wishlist-preview") && sitemartThemeModule.removeDuplicatedStylesFromHTML(e.wishlist_content, function(t) {
                        o.replaceWith(t), sitemartThemeModule.$document.trigger("djUpdateWishlist")
                    }), setTimeout(function() {
                        var t = c(".dj-wishlist-content .dj-pagination").find("a.page-numbers");
                        t.length && t.each(function() {
                            var t = c(this),
                                e = t.attr("href").split("product-page=")[1],
                                e = parseInt(e);
                            t.attr("href", window.location.origin + window.location.pathname + "?product-page=" + e)
                        })
                    }, 500)) : console.log("something wrong loading wishlist data ", t), t.fragments && sitemartThemeModule.$document.trigger("djUpdateWishlistFragments", [t.fragments, t.hash]), d && d()
                },
                error: function() {
                    console.log("We cant remove from wishlist. Something wrong with AJAX response. Probably some PHP conflict.")
                }
            })
        }

        var csrfmiddlewaretoken = document.querySelector('input[name="csrfmiddlewaretoken"]').value
        function l(t, elm_) {

            c.ajax({
                url: sitemart_settings.ajaxurl,
                data: {
                    action: "new_wish_item",
                    csrfmiddlewaretoken: csrfmiddlewaretoken,
                    product_id: t.data("product-id"),
                },
                dataType: "json",
                method: "POST",
                success: function(r) {
                    elm_.forEach((elm) => elm_.innerHTML = parseInt(Cookies.get('sitemart_wishlist_count')) + 1);

                    var e = t.data("added-text");
                    t.addClass("added");
                    (0 < t.find("span").length ? t.find("span") : t).text(e);
                },
                error: function () {
                    e(document.body).trigger("fs_fragments_ajax_error")
                }
            });
        }
    }, sitemartThemeModule.updateWishlistButtonState = function() {
        var t, e;
        void 0 === sitemart_settings.wishlist_save_button_state || "yes" !== sitemart_settings.wishlist_save_button_state || "undefined" == typeof Cookies || sitemartThemeModule.$body.hasClass("logged-in") || (e = "sitemart_wishlist_products", t = {}, sitemart_settings.is_multisite && (e += "_" + sitemart_settings.current_blog_id), (t = void 0 !== (e = Cookies.get(e)) && e ? Object.values(JSON.parse(e)) : t).length && c.each(t, function(t, e) {
            var o, e = c(".dj-wishlist-btn a[data-product-id=" + e.product_id + "]");
            e.length && !e.hasClass("added") && (e.addClass("added"), o = e.data("added-text"), (0 < e.find("span").length ? e.find("span") : e).text(o))
        }))
    }, c(document).ready(function() {
        sitemartThemeModule.wishlist(), sitemartThemeModule.updateWishlistButtonState()
    })
}(jQuery);