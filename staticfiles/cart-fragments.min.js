jQuery(function (e) {
    if ("undefined" == typeof fs_cart_fragments_params) return !1;
    var t = !0,
        r = fs_cart_fragments_params.cart_hash_key;
    try {
        t = "sessionStorage" in window && null !== window.sessionStorage, window.sessionStorage.setItem("fs", "test"), window.sessionStorage.removeItem("fs"), window.localStorage.setItem("fs", "test"), window.localStorage.removeItem("fs")
    } catch (f) {
        t = !1
    }


    function o(e) {
        t && (localStorage.setItem(r, e), sessionStorage.setItem(r, e))
    }

    var csrfmiddlewaretoken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
    var a = {
        url: fs_cart_fragments_params.fs_ajax_url.toString(),
        type: "POST",
        data: {
            'action': 'Get_data',
            'csrfmiddlewaretoken': csrfmiddlewaretoken,
            time: (new Date).getTime()
        },
        timeout: fs_cart_fragments_params.request_timeout,
        success: function (r) {
            console.log(r)
            r && r.fragments && (e.each(r.fragments, function (t, r) {
                e(t).replaceWith(r)
            }), t && (sessionStorage.setItem(fs_cart_fragments_params.fragment_name, JSON.stringify(r.fragments))), e(document.body).trigger("fs_fragments_refreshed"));

            var cartitems_count = document.querySelectorAll('.dj-cart-number');
            var amount = document.querySelector('body > div.website-wrapper > header > div > div.whb-row.whb-header-bottom.whb-sticky-row.whb-without-bg.whb-border-fullwidth.whb-color-dark.whb-hidden-mobile.whb-flex-flex-middle > div > div > div.whb-column.whb-col-right.whb-visible-lg > div.dj-header-cart.dj-tools-element.dj-design-2.cart-widget-opener.whb-nedhm962r512y1xz9j06 > a > span.dj-tools-text > span > span');

            cartitems_count.forEach(element => {
                element.innerHTML = r.cart_items_count;
            });
            amount.innerHTML = '<span class="site_front-Price-amount amount"><bdi data-price="'+  r.total_price + '">' + r.total_price +'&nbsp;<span class="site_front-Price-currencySymbol">تومان</span></bdi></span>';
            FormatPrices('.site_front-Price-amount bdi');

        },
        error: function () {
            e(document.body).trigger("fs_fragments_ajax_error")
        }
    };

    function s() {
        e.ajax(a)
    }
    if (t) {
        var i = null;
        e(document.body).on("fs_fragment_refresh updated_fs_div", function () {
            s()
        }), e(document.body).on("added_to_cart removed_from_cart", function (e, t, a) {
            var s = sessionStorage.getItem(r);
            null !== s && s !== undefined && "" !== s || n(), sessionStorage.setItem(fs_cart_fragments_params.fragment_name, JSON.stringify(t)), o(a)
        }), e(document.body).on("fs_fragments_refreshed", function () {
            clearTimeout(i), i = setTimeout(s, 864e5)
        }), e(window).on("storage onstorage", function (e) {
            r === e.originalEvent.key && localStorage.getItem(r) !== sessionStorage.getItem(r) && s()
        }), e(window).on("pageshow", function (t) {
            t.originalEvent.persisted && (e(".widget_shopping_cart_content").empty(), e(document.body).trigger("fs_fragment_refresh"))
        });
        try {
            var c = JSON.parse(sessionStorage.getItem(fs_cart_fragments_params.fragment_name)),
                _ = sessionStorage.getItem(r),
                g = Cookies.get("site_front_cart_hash"),
                m = sessionStorage.getItem("fs_cart_created");
            if (null !== _ && _ !== undefined && "" !== _ || (_ = ""), null !== g && g !== undefined && "" !== g || (g = ""), _ && (null === m || m === undefined || "" === m)) throw "No cart_created";
            if (m) {
                var d = 1 * m + 864e5,
                    w = (new Date).getTime();
                if (d < w) throw "Fragment expired";
                i = setTimeout(s, d - w)
            }
            if (!c || !c["div.widget_shopping_cart_content"] || _ !== g) throw "No fragment";
            e.each(c, function (t, r) {
                e(t).replaceWith(r)
            }), e(document.body).trigger("fs_fragments_loaded")
        } catch (f) {
            s()
        }
    } else s();
    Cookies.get("site_front_items_in_cart") > 0 ? e(".hide_cart_widget_if_empty").closest(".widget_shopping_cart").show() : e(".hide_cart_widget_if_empty").closest(".widget_shopping_cart").hide(), e(document.body).on("adding_to_cart", function () {
        e(".hide_cart_widget_if_empty").closest(".widget_shopping_cart").show()
    }), "undefined" != typeof wp && wp.customize && wp.customize.selectiveRefresh && wp.customize.widgetsPreview && wp.customize.widgetsPreview.WidgetPartial && wp.customize.selectiveRefresh.bind("partial-content-rendered", function () {
        s()
    })
});

