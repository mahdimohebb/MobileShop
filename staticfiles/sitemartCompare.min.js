!function(m){sitemartThemeModule.$document.on("djShopPageInit djUpdateWishlist djArrowsLoadProducts djLoadMoreLoadProducts djProductsTabsLoaded djSearchFullScreenContentLoaded djBackHistory djRecentlyViewedProductLoaded",function(){sitemartThemeModule.sitemartCompareUpdateState()}),sitemartThemeModule.sitemartCompare=function(){var r="sitemart_compare_list";if(sitemart_settings.is_multisite&&(r+="_"+sitemart_settings.current_blog_id),"undefined"!=typeof Cookies){var e,o=sitemartThemeModule.$body,t=m(".dj-header-compare"),a=Cookies.get(r);if(0<t.length){if(void 0!==a)try{var n=JSON.parse(a);t.find(".dj-tools-count").text(n.length)}catch(e){console.log("cant parse cookies json")}else t.find(".dj-tools-count").text(0);if(void 0!==sitemart_settings.compare_by_category&&"yes"===sitemart_settings.compare_by_category)try{sitemartThemeModule.supports_html5_storage&&(e=JSON.parse(sessionStorage.getItem(r+"_fragments")),e="undefined"==typeof actions||"1"!==actions.is_lang_switched&&"1"!==actions.force_reset?e:"")?m.each(e,function(e,o){m(e).replaceWith(o)}):i()}catch(e){i()}}o.on("click",".dj-compare-btn a",function(e){var t=m(this),o=t.data("id"),a=m(".dj-header-compare");if(t.hasClass("added"))return!0;e.preventDefault(),a.find(".dj-dropdown-compare").length?(t.addClass("loading"),jQuery.ajax({url:sitemart_settings.ajaxurl,data:{action:"sitemart_add_to_compare",id:o},dataType:"json",method:"GET",success:function(e){var o;e.count?(0<(o=m(".dj-header-compare")).length&&o.find(".dj-tools-count").text(e.count),c(t)):console.log("something wrong loading compare data ",e),e.fragments&&(m.each(e.fragments,function(e,o){m(e).replaceWith(o)}),sessionStorage.setItem(r+"_fragments",JSON.stringify(e.fragments)))},error:function(){console.log("We cant add to compare. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){t.removeClass("loading")}})):(e=[],(e=void 0!==(a=Cookies.get(r))&&a?Object.values(JSON.parse(a)):e).length&&-1!==e.indexOf(o.toString())||e.push(o.toString()),a=e.length,o=a,0<(a=m(".dj-header-compare")).length&&a.find(".dj-tools-count").text(o),Cookies.set(r,JSON.stringify(e),{expires:7,path:sitemart_settings.cookie_path,secure:sitemart_settings.cookie_secure_param}),c(t))}),o.on("click",".dj-compare-remove",function(e){e.preventDefault();var o=m(this),e=o.data("id"),t="";void 0!==sitemart_settings.compare_by_category&&"yes"===sitemart_settings.compare_by_category&&(t=o.parents(".dj-compare-table").data("category-id"))&&o.parents(".compare-value").siblings().length<=1?d(t,o.parents(".dj-compare-page")):(o.addClass("loading"),jQuery.ajax({url:sitemart_settings.ajaxurl,data:{action:"sitemart_remove_from_compare",id:e,category_id:t,key:sitemart_settings.compare_page_nonce},dataType:"json",method:"GET",success:function(e){e.table?(s(e),e.fragments&&(m.each(e.fragments,function(e,o){m(e).replaceWith(o)}),sessionStorage.setItem(r+"_fragments",JSON.stringify(e.fragments)))):console.log("something wrong loading compare data ",e)},error:function(){console.log("We cant remove product compare. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){o.remove("loading")}}))}),o.on("change",".dj-compare-select",function(e){e.preventDefault();var e=m(this),o=e.parents(".dj-compare-page"),t=o.find(".dj-compare-table[data-category-id="+e.val()+"]"),a=o.find(".dj-compare-table.dj-active");o.find(".dj-compare-cat-link").attr("href",t.data("category-url")),a.removeClass("dj-in"),setTimeout(function(){a.removeClass("dj-active")},100),setTimeout(function(){t.addClass("dj-active")},100),setTimeout(function(){t.addClass("dj-in"),sitemartThemeModule.$document.trigger("dfsd-images-loaded")},200)}),o.on("click",".dj-compare-remove-cat",function(e){e.preventDefault();e=m(this);d(e.parents(".dj-compare-header").find(".dj-compare-select").val(),e.parents(".dj-compare-page"))})}function d(e,o){var t=o.find(".dj-loader-overlay");t.addClass("dj-loading"),jQuery.ajax({url:sitemart_settings.ajaxurl,data:{action:"sitemart_remove_category_from_compare",category_id:e,key:sitemart_settings.compare_page_nonce},dataType:"json",method:"GET",success:function(e){e.table?(s(e),e.fragments&&(m.each(e.fragments,function(e,o){m(e).replaceWith(o)}),sessionStorage.setItem(r+"_fragments",JSON.stringify(e.fragments)))):console.log("something wrong loading compare data ",e)},error:function(){console.log("We cant remove product compare. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){t.removeClass("dj-loading");var e=m(".dj-compare-table").first();setTimeout(function(){e.addClass("dj-active")},100),setTimeout(function(){e.addClass("dj-in"),sitemartThemeModule.$document.trigger("dfsd-images-loaded")},200)}})}function s(e){var o=m(".dj-header-compare");0<o.length&&o.find(".dj-tools-count").text(e.count),sitemartThemeModule.removeDuplicatedStylesFromHTML(e.table,function(e){var o=m(".dj-compare-page"),t=m(".dj-compare-table");0<o.length?o.replaceWith(e):0<t.length&&t.replaceWith(e)}),void 0!==sitemart_settings.compare_by_category&&"yes"===sitemart_settings.compare_by_category&&sitemartThemeModule.$document.trigger("djTabsInit")}function i(){jQuery.ajax({url:sitemart_settings.ajaxurl,data:{action:"sitemart_get_fragment_product_category_compare"},dataType:"json",method:"GET",success:function(e){e.fragments?(m.each(e.fragments,function(e,o){m(e).replaceWith(o)}),sessionStorage.setItem(r+"_fragments",JSON.stringify(e.fragments))):console.log("something wrong loading compare data ",e)},error:function(){console.log("We cant remove product compare. Something wrong with AJAX response. Probably some PHP conflict.")}})}function c(e){var o=e.data("added-text");(0<e.find("span").length?e.find("span"):e).text(o),e.addClass("added"),sitemartThemeModule.$document.trigger("added_to_compare"),sitemartThemeModule.$document.trigger("djUpdateTooltip",e)}},sitemartThemeModule.sitemartCompareUpdateState=function(){var e,o;void 0!==sitemart_settings.compare_save_button_state&&"yes"===sitemart_settings.compare_save_button_state&&"undefined"!=typeof Cookies&&(o="sitemart_compare_list",e=[],sitemart_settings.is_multisite&&(o+="_"+sitemart_settings.current_blog_id),(e=void 0!==(o=Cookies.get(o))&&o?Object.values(JSON.parse(o)):e).length)&&m.each(e,function(e,o){var t,o=m(".dj-compare-btn a[data-id="+o+"]");o.length&&!o.hasClass("added")&&(o.addClass("added"),t=o.data("added-text"),(0<o.find("span").length?o.find("span"):o).text(t))})},m(document).ready(function(){sitemartThemeModule.sitemartCompare(),sitemartThemeModule.sitemartCompareUpdateState()})}(jQuery);